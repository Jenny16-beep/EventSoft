{% extends 'base.html' %}

{% block title %}
    Gestionar Archivos - {{ evento.eve_nombre }}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üìÅ Gestionar Archivos del Evento</h2>
                <a href="{% url 'listar_eventos' %}" class="btn btn-secondary">
                    ‚¨ÖÔ∏è Volver a Mis Eventos
                </a>
            </div>

            <!-- Informaci√≥n del evento -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìã {{ evento.eve_nombre }}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Ciudad:</strong> {{ evento.eve_ciudad }}</p>
                            <p><strong>Lugar:</strong> {{ evento.eve_lugar }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Fecha Inicio:</strong> {{ evento.eve_fecha_inicio }}</p>
                            <p><strong>Fecha Fin:</strong> {{ evento.eve_fecha_fin }}</p>
                            <p><strong>Estado:</strong> 
                                <span class="badge bg-info">{{ evento.eve_estado }}</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Memorias del Evento -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">üìö Memorias del Evento</h5>
                        </div>
                        <div class="card-body">
                            {% if evento.eve_memorias %}
                                <div class="alert alert-success">
                                    <h6>‚úÖ Archivo actual:</h6>
                                    <p class="mb-2"><strong>{{ evento.eve_memorias.name|cut:"eventos/memorias/" }}</strong></p>
                                    <a href="{{ evento.eve_memorias.url }}" target="_blank" class="btn btn-sm btn-outline-success">
                                        üëÅÔ∏è Ver archivo
                                    </a>
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" data-bs-toggle="modal" data-bs-target="#eliminarMemoriasModal">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </div>
                            {% else %}
                                <div class="alert alert-warning">
                                    <h6>‚ö†Ô∏è Sin memorias cargadas</h6>
                                    <p class="mb-0">No hay memorias disponibles para este evento.</p>
                                </div>
                            {% endif %}

                            <!-- Formulario para cargar memorias -->
                            <form method="post" enctype="multipart/form-data" class="mt-3">
                                {% csrf_token %}
                                <input type="hidden" name="archivo_tipo" value="memorias">
                                <div class="mb-3">
                                    <label for="memorias" class="form-label">Cargar/Actualizar Memorias:</label>
                                    <input type="file" class="form-control" id="memorias" name="archivo" accept=".pdf,.doc,.docx,.ppt,.pptx,.zip">
                                    <div class="form-text">Formatos aceptados: PDF, DOC, DOCX, PPT, PPTX, ZIP</div>
                                </div>
                                <button type="submit" class="btn btn-success">
                                    üíæ {{ evento.eve_memorias|yesno:"Actualizar,Cargar" }} Memorias
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n T√©cnica -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">‚öôÔ∏è Informaci√≥n T√©cnica</h5>
                        </div>
                        <div class="card-body">
                            {% if evento.eve_informacion_tecnica %}
                                <div class="alert alert-success">
                                    <h6>‚úÖ Archivo actual:</h6>
                                    <p class="mb-2"><strong>{{ evento.eve_informacion_tecnica.name|cut:"eventos/informacion_tecnica/" }}</strong></p>
                                    <a href="{{ evento.eve_informacion_tecnica.url }}" target="_blank" class="btn btn-sm btn-outline-success">
                                        üëÅÔ∏è Ver archivo
                                    </a>
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" data-bs-toggle="modal" data-bs-target="#eliminarInfoTecnicaModal">
                                        üóëÔ∏è Eliminar
                                    </button>
                                </div>
                            {% else %}
                                <div class="alert alert-warning">
                                    <h6>‚ö†Ô∏è Sin informaci√≥n t√©cnica cargada</h6>
                                    <p class="mb-0">No hay informaci√≥n t√©cnica disponible para este evento.</p>
                                </div>
                            {% endif %}

                            <!-- Formulario para cargar informaci√≥n t√©cnica -->
                            <form method="post" enctype="multipart/form-data" class="mt-3">
                                {% csrf_token %}
                                <input type="hidden" name="archivo_tipo" value="informacion_tecnica">
                                <div class="mb-3">
                                    <label for="info_tecnica" class="form-label">Cargar/Actualizar Informaci√≥n T√©cnica:</label>
                                    <input type="file" class="form-control" id="info_tecnica" name="archivo" accept=".pdf,.doc,.docx,.ppt,.pptx,.zip">
                                    <div class="form-text">Formatos aceptados: PDF, DOC, DOCX, PPT, PPTX, ZIP</div>
                                </div>
                                <button type="submit" class="btn btn-info">
                                    üíæ {{ evento.eve_informacion_tecnica|yesno:"Actualizar,Cargar" }} Informaci√≥n T√©cnica
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informaci√≥n adicional -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6 class="card-title">‚ÑπÔ∏è Informaci√≥n importante:</h6>
                    <ul class="mb-0">
                        <li><strong>Memorias:</strong> Documentos finales del evento que pueden descargar asistentes, participantes y evaluadores.</li>
                        <li><strong>Informaci√≥n T√©cnica:</strong> Documentos con detalles t√©cnicos que ayuden a los participantes a tener un mejor desempe√±o.</li>
                        <li><strong>Formatos aceptados:</strong> PDF, DOC, DOCX, PPT, PPTX, ZIP</li>
                        <li><strong>Archivos ZIP:</strong> √ötiles para subir m√∫ltiples documentos o carpetas completas.</li>
                        <li>Los archivos se pueden actualizar en cualquier momento mientras el evento est√© activo.</li>
                        <li>Tama√±o m√°ximo por archivo: 50MB.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar memorias -->
<div class="modal fade" id="eliminarMemoriasModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üóëÔ∏è Eliminar Memorias</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¬øEst√°s seguro de que deseas eliminar las memorias del evento?</p>
                <p class="text-muted">Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form method="post" action="{% url 'eliminar_archivo_evento' evento.eve_id %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="archivo_tipo" value="memorias">
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar informaci√≥n t√©cnica -->
<div class="modal fade" id="eliminarInfoTecnicaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üóëÔ∏è Eliminar Informaci√≥n T√©cnica</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¬øEst√°s seguro de que deseas eliminar la informaci√≥n t√©cnica del evento?</p>
                <p class="text-muted">Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form method="post" action="{% url 'eliminar_archivo_evento' evento.eve_id %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="archivo_tipo" value="informacion_tecnica">
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
